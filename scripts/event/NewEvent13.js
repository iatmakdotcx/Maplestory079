/* 
 * 测试脚本
 */
var BOSS = Array(
				  Array(9300304,300000000000,"SS"),//SS级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9390868,300000000000,"SS"),//强力的海龙
				  Array(9410301,300000000000,"SS"),//冒险岛GM
				  Array(9601031,600000000000,"SSS"),//双头蛇召唤怪
				  Array(9601020,600000000000,"SSS"),//黄龙
				  Array(9601019,300000000000,"SS"),//宋达
				  Array(9601018,300000000000,"SS"),//悟空
				  Array(9601017,300000000000,"SS"),//凤仙
				  Array(9601016,300000000000,"SS"),//阿狼
				  Array(9390867,300000000000,"SS"),//凶猛的深海巨妖
				  //Array(2600715,300000000000,"SS"),//雷卡
				  Array(2600311,300000000000,"道具类"),//阿狼
				  Array(9300865,300000000000,"SS"),//班·雷昂
				  Array(9601016,300000000000,"SS"),//阿狼
				  Array(9601016,300000000000,"SS"),//阿狼

				  Array(9300293,100000000000,"S"),//S级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9300294,100000000000,"S"),//S级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9410293,100000000000,"S"),//漂亮可爱贝鲁米诺米MK2
				  Array(9300294,100000000000,"S"),
				  Array(9300294,100000000000,"S"),
				  Array(9300294,100000000000,"S"),
				  Array(9300293,100000000000,"S"),//S级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9300294,100000000000,"S"),//S级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9410293,100000000000,"S"),//漂亮可爱贝鲁米诺米MK2
				  Array(9300294,100000000000,"S"),
				  Array(9300294,100000000000,"S"),
				  Array(9300294,100000000000,"S"),

				  Array(9300291,30000000000,"A"),//A级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9300292,30000000000,"A"),//A级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9300291,30000000000,"A"),//A级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9410292,30000000000,"A"),//匈奴皮埃尔
				  Array(9410291,30000000000,"A"),//咆哮女王
				  Array(9410290,30000000000,"A"),//小鸡半半
				  Array(9390911,30000000000,"A"),//神秘参赛选手
				  Array(9300786,30000000000,"A"),//艾利杰
				  Array(9300787,30000000000,"A"),//艾菲尼娅
				  Array(9300788,30000000000,"A"),//远古精灵
				  Array(9390911,30000000000,"A"),//神秘参赛选手

				  Array(9300291,30000000000,"A"),//A级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9300292,30000000000,"A"),//A级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9300291,30000000000,"A"),//A级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9410292,30000000000,"A"),//匈奴皮埃尔
				  Array(9410291,30000000000,"A"),//咆哮女王
				  Array(9410290,30000000000,"A"),//小鸡半半
				  Array(9390911,30000000000,"A"),//神秘参赛选手
				  Array(9300786,30000000000,"A"),//艾利杰
				  Array(9300787,30000000000,"A"),//艾菲尼娅
				  Array(9300788,30000000000,"A"),//远古精灵
				  Array(9390911,30000000000,"A"),//神秘参赛选手

				  Array(9801002,2000000000,"B"),//B级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9801003,2000000000,"B"),//B级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9601004,20000,"B"),//BIG蘑菇王
				  Array(9400923,199999,"B"),//仲博拉大帝
				  Array(9400922,199999,"B"),//圆滑的温死
				  Array(9600187,400000,"B"),//夕
				  Array(9390918,2000000000,"B"),//维克特
				  Array(9390917,2000000000,"B"),//文森特
				  Array(9390916,2000000000,"B"),//比奇
				  Array(2600208,2000000000,"B"),//蘑菇王
				  Array(9300815,2000000000,"B"),//蘑菇王
				  Array(9309096,2000000000,"B"),//蘑菇王
				  Array(9309097,2000000000,"B"),//蘑菇王
				  Array(2600208,2000000000,"B"),//蘑菇王
				  Array(9600226,2000000000,"B"),//麦格纳斯
				   Array(9801004,2000000000,"B"),//B级怪物ID、怪物血量、怪物物伤、怪物魔伤

				   Array(9801002,2000000000,"B"),//B级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9801003,2000000000,"B"),//B级怪物ID、怪物血量、怪物物伤、怪物魔伤
				  Array(9601004,20000,"B"),//BIG蘑菇王
				  Array(9400923,199999,"B"),//仲博拉大帝
				  Array(9400922,199999,"B"),//圆滑的温死
				  Array(9600187,400000,"B"),//夕
				  Array(9390918,2000000000,"B"),//维克特
				  Array(9390917,2000000000,"B"),//文森特
				  Array(9390916,2000000000,"B"),//比奇
				  Array(2600208,2000000000,"B"),//蘑菇王
				  Array(9300815,2000000000,"B"),//蘑菇王
				  Array(9309096,2000000000,"B"),//蘑菇王
				  Array(9309097,2000000000,"B"),//蘑菇王
				  Array(2600208,2000000000,"B"),//蘑菇王
				  Array(9600226,2000000000,"B"),//麦格纳斯
				   Array(9801004,2000000000,"B"),//B级怪物ID、怪物血量、怪物物伤、怪物魔伤

				  Array(9801005,2000000000,"B")//B级怪物ID、怪物血量、怪物物伤、怪物魔伤
);
var BOSSMAP = Array(324014000,1129,-575);//乱入出现的地图、X坐标、Y坐标
var BOSSChance = 25;//（数字÷500）×100%
function init() {
    em.setProperty("state", "0");//state = 为1代表有没有人，2代表是否有BOSS乱入,3代表有没有通行证
    em.setProperty("leader", "false");
}

function setup(level, leaderid) {
    em.setProperty("state", "1");
    var eim = em.newInstance("NewEvent13");
    eim.setInstanceMap(324010000).resetPQ(level);
    eim.setInstanceMap(324011000).resetPQ(level);
    eim.setInstanceMap(324012000).resetPQ(level);
    eim.setInstanceMap(324013000).resetPQ(level);
    eim.setInstanceMap(324014000).resetPQ(level);
    eim.setInstanceMap(324015000).resetPQ(level);
    eim.setInstanceMap(324016000).resetPQ(level);
    var map = eim.setInstanceMap(324016000);
    map.resetFully();
    var mob = em.getMonster(9600025);
    mob.changeLevel(level);
	mob.getChangedStats().setOHp(250000000);
    mob.setHp(250000000);
    eim.registerMonster(mob);
    map.spawnMonsterOnGroundBelow(mob, new java.awt.Point(1214,170));
	//----以下为BOSS乱入召唤
	var A =  Math.floor(Math.random()*BOSS.length);
	var C = BOSS[A];//取到怪物行
	var chance = Math.floor(Math.random() * 500);
	if (chance<BOSSChance||em.getProperty("leader")=="true"){
		var map1 = eim.setInstanceMap(BOSSMAP[0]);
		var mob1 = em.getMonster(C[0]);
		mob1.changeLevel(level);
		mob1.getChangedStats().setOHp(C[1]);
		mob1.setHp(C[1]);
		eim.registerMonster(mob1);
		map1.spawnMonsterOnGroundBelow(mob1, new java.awt.Point(BOSSMAP[1], BOSSMAP[2]));
		em.broadcastServerMsg(5121027, "注意：仙人修炼场 "+C[2]+" 级BOSS乱入" ,true);
	}
    eim.startEventTimer(1000 * 60 * 30); //60 min
    return eim;
}

function playerEntry(eim, player) {
    var map = eim.getMapInstance(0);
    player.changeMap(map, map.getPortal(0));
}

function playerRevive(eim, player) {
    return false;
}

function changedMap(eim, player, mapid) {
    if (mapid < 324010000 || mapid > 324016000) {
        eim.unregisterPlayer(player);
        if (eim.disposeIfPlayerBelow(0, 0)) {
            em.setProperty("state", "0");
            em.setProperty("leader", "false");
        }
    }
}

function playerDisconnected(eim, player) {
    eim.disposeIfPlayerBelow(100, 910340700);
    em.setProperty("state", "0");
    em.setProperty("leader", "false");
    return 0;
}

function monsterValue(eim, mobId) {
    return 1;
}

function playerExit(eim, player) {
    eim.unregisterPlayer(player);
    if (eim.disposeIfPlayerBelow(0, 0)) {
        em.setProperty("state", "0");
        em.setProperty("leader", "false");
    }
}
function scheduledTimeout(eim) {
    eim.disposeIfPlayerBelow(100, 910340700);
    em.setProperty("state", "0");
    em.setProperty("leader", "false");
}

function clearPQ(eim) {
    scheduledTimeout(eim);
}

function allMonstersDead(eim) {
	em.broadcastServerMsg(5121027, "恭喜玩家通关仙人修炼场，请在10秒内狂点NPC获取奖励！" ,true);
    eim.startEventTimer(1000 * 10); //10 min
    eim.getMapInstance(324016000).spawnNpc(9390445, new java.awt.Point(1214,170));
}

function leftParty(eim, player) {}
function disbandParty(eim) {}
function playerDead(eim, player) {}
function cancelSchedule() {}
function monsterDrop(eim, player, mob) {}